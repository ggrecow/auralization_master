
++ 31.03.2025 (all these changes need to be transfered to SQAT_MASTER)

inlcuded get_binaural function in MASTER_auralization_EngineAirframe

- DEFAULT values (.ini file)

	binaural_signal = 0, defined in MASTER_auralization_EngineAirframe
	head_orientation = 0, defined in the 

++ 28.03.2025 (all these changes need to be transfered to SQAT_MASTER)

- deleted imission-bsaed part from MASTER_auralization_EngineAirframe

- Several changes to allow for HRTF synthesis. Main point to allot for that is the individual processing of
	the direct and reflected sound paths, which were until now performed together
	
CHANGES ON: get_propagation
- new output provides propagation time to facilitate the computation of the relative delay between the two rays on the FIR procedure
- a OUT structure is now the only oitput of the get_propagation function

CHANGES ON: apply_propagation_FIR1	
- apply_propagation_FIR1 was deprecated
- apply_propagation_HRTF is now the new function (largely based on apply_propagation_FIR1), but more structured
  - apply_propagation_HRTF handles directand reflected soundpahts individually  
  - apply_propagation_HRTF -> get_FIR_from_atm_TF, which creates the FIR filters - minimum phase (direct) - linear phase (reflected)
  - get_FIR_from_atm_TF, used the AKphaseManipulation.m function from the AKtools (added in the third party folder)	
  - apply_propagation_HRTF -> overlapp_add_convolution, just like before but now in a individual function	

With those changes, nTaps is not really necessary as an input anymore. nfft = round(fs*dt_panam) for the freq vector of the 
transfer function in get_propagation, and nTaps is chosen to be defined by a desired lower freq (10Hz) in the FIR filters 
, as implemented in the apply_propagation function


- DEFAULT values (.ini file)

	AttenuationdB = 0, defined in MASTER_auralization_EngineAirframe
	sampling_freq = 48000, defined in MASTER_auralization_EngineAirframe
	nfft - not necessary anymore. Must be removed from input file
	consider_ground_reflection = 1, defined in MASTER_auralization_EngineAirframe
	sigma_e = 100000e3, defined in get_propagation

---------------------------------------------------------------------------------------------------------------------------------------

%% 13.03.2025

% i think iver never worked with data with only 1 receiver. had to cahnge the reorganizing bit in the 
<PANAM_SQAT_data_conversion.m>, which was not working when we have only one receiver in the input data

% deleted other receiver position from the data, only remains receiver 1 - app centerline
input data: C:\Users\greco\Desktop\auralization_verification_thesis\input\2023_greco_testcase_doppler\fine_discretization\V-R\approach
 

---------------------------------------------------------------------------------------------------------------------------------------

%% problems and changes when/after auralizing the A320 ATRA data from lothar (original files with FDR flight profile)
 

19.11.2024

---------------------------------------------------------------------------------------------------------------------------------------
- (SOLVED)cutting the data based on the max. SPL of the EMISSION dont make any sense. It only works for imission-based auralization. 
  A more general approach which shall work for both cases, is to base the trim on the min euclidian distance between source/observer. This is now implemented in the new
  <trim_data_TimeDistanceBased function> 
 
- problema com velocidade negativa na funcao cutting flight profile (rectangle fail )

- trim time nao ta cortando direito, entao broadband time nao ta redondo e da problema

- trimming algorith has a problem, because it trims the data based on the emission. The assumption is that the emission is higher in the overhead position, 
  so the trimm is made in the middle of the flight. however,  this asssumption may brakes like in this case, which is not a dep nor app (arremetida), and the
  aircraft starts to accelerate only in the end, when its already far away.
----------------------------------------------------------------------------------------------------------------

% 14.11.2024

(REMARK) FDR flight profile with non-uniform time step are tricky to handle, not feasible to cut the flight profile using th current approach using 
	 TrimTimebins = TrimTime/dt because dr is not constant
  	 There are also another problems related to the time windows used for the broadband synthesis. 
	 it is just not feasible to work with non constant dt, this should be avoided
 
----------------------------------------------------------------------------------------------------------------------------------------------------------
(DONE) comentado : run startup_SQAT_PANAM.m; no codigo principal, q tinha sido introduzido p gerar o .exe

(DONE) incluir close all no final do loop de receivers na funcao principal

(DONE) OB to NB conversion - smoothed curve taken out of the plot 

(DONE) OB to NB conversion - spectrogram graph comparing equal/smoothed distribution was commented out becuase it is unnecessary 

(DONE) wav file name changed to AttenuationTag = ['_FS' sprintf('%.1d',94-AttenuationdB) 'dBSPL']; 

(DONE) getPropagation.m - receiver height is truncated to 1 cm if the original value is 0m. This is because the raay tracing hae difficulties to find a reflection when the receiver
	is at 0m. Another workaournds where investigate but this was the best compromise for now. See comment on the codes for more info